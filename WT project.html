 <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EduCare Complaint Management</title>
<style>
  body { font-family: 'Segoe UI', Arial, sans-serif; margin:0; background: linear-gradient(135deg,#e3f0ff,#efeffd);}
  nav { background: linear-gradient(90deg,#1167b1,#00c6ff); padding:1.2rem 2rem; color:white; display:flex; justify-content:space-between; align-items:center; box-shadow:0 2px 8px rgba(0,0,0,0.12); visibility:hidden;}
  nav.active{visibility:visible;}
  nav h2{margin:0;font-size:1.4rem; letter-spacing:1px;}
  nav a, nav span.logout-link{color:white; margin-left:1.2rem; text-decoration:none; cursor:pointer; font-weight:500; transition: color 0.2s; font-size:1rem;}
  nav a:hover, nav span.logout-link:hover{color:#ffe082; text-decoration:underline;}
  .container{padding:2rem; max-width:900px; margin:2.5rem auto 1.5rem; background:white; border-radius:14px; box-shadow:0 4px 16px rgba(0,0,0,0.10); display:none; animation:fadeIn 0.5s;}
  .container.active{display:block;}
  h1,h2{margin-top:0; color:#1167b1;}
  button{background:linear-gradient(90deg,#1167b1,#00c6ff); color:white; border:none; padding:0.85rem 2rem; border-radius:30px; font-size:1.1rem; cursor:pointer; font-weight:bold; letter-spacing:1px; margin-top:1rem; transition:transform 0.16s;}
  button:hover{background:#1167b1; transform:scale(1.04);}
  input, select, textarea{width:100%; padding:0.8rem; margin:0.7rem 0 1rem 0; border:1px solid #bdbdbd; border-radius:7px; font-size:1rem; transition:border-color 0.2s;}
  input:focus, textarea:focus, select:focus{border-color:#1167b1; outline:none;}
  table{width:100%; border-collapse:collapse; box-shadow:0 2px 10px rgba(0,0,0,0.05); margin-top:1.2rem;}
  th, td{text-align:left; padding:0.9rem; border-bottom:1px solid #e0e0e0;}
  th{background:#e3f4fd; font-weight:bold; color:#1167b1;}
  .card{background:#f6fbff; padding:1.1rem 1.2rem; border-radius:10px; margin:1.2rem 0; box-shadow:0 2px 8px rgba(0,0,0,0.08); transition:box-shadow 0.2s;}
  .card:hover{box-shadow:0 4px 16px rgba(0,0,0,0.13);}
  #imagePreview img{max-width:250px; border-radius:10px; margin-top:10px; box-shadow:0 2px 8px rgba(0,0,0,0.12);}
  .form-switch{color:#666; margin-top:1.2rem; cursor:pointer;}
  .form-switch:hover{text-decoration:underline; color:#1167b1;}
  .modal-bg{display:none; position:fixed; z-index:9999; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.45); justify-content:center; align-items:center;}
  .modal-bg.active{display:flex;}
  .modal-content{background:#fff; border-radius:12px; box-shadow:0 4px 24px rgba(0,0,0,0.17); padding:2rem 2.5rem; min-width:340px; max-width:90vw; animation:fadeIn 0.3s;}
  .modal-content h3{margin-top:0; color:#1167b1;}
  .modal-content img{max-width:350px; max-height:180px; display:block; margin:1rem 0; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.13);}
  .modal-close{float:right; margin:-1rem -1rem 1rem 1rem; background:#e0e7ef; color:#1167b1; border:none; border-radius:20px; font-weight:bold; font-size:1.2rem; cursor:pointer; padding:0 0.8rem;}
  @media (max-width:820px){.container{padding:1rem;} .modal-content{padding:1rem;} nav{flex-direction:column;} nav h2, nav div{margin-bottom:0.6rem;}}
  @keyframes fadeIn{from{opacity:0; transform:translateY(16px);} to{opacity:1; transform:translateY(0);}}
</style>
</head>
<body>

<nav id="topnav">
  <h2>EduCare</h2>
  <div id="mainNavLinks"></div>
</nav>

<div class="modal-bg" id="staffModal">
  <div class="modal-content" id="modalContent">
    <button class="modal-close" onclick="closeModal()">&times;</button>
    <h3>Complaint Details</h3>
    <div id="modalDesc"></div>
  </div>
</div>

<!-- Login -->
<div id="login" class="container active">
  <h2>Login</h2>
  <form onsubmit="userLogin(event)">
    <input type="text" id="loginUser" placeholder="Username" required>
    <input type="password" id="loginPass" placeholder="Password" required>
    <button type="submit">Login</button>
  </form>
  <div class="form-switch" onclick="showLoginOrSignup('signup')">Don't have an account? Signup</div>
</div>

<!-- Signup -->
<div id="signup" class="container">
  <h2>Signup</h2>
  <form onsubmit="userSignup(event)">
    <input type="text" id="signupUser" placeholder="Create Username" required>
    <input type="password" id="signupPass" placeholder="Create Password" required>
    <button type="submit">Signup</button>
  </form>
  <div class="form-switch" onclick="showLoginOrSignup('login')">Already have an account? Login</div>
</div>

<!-- Home -->
<div id="home" class="container" style="text-align:center;">
  <h1>Welcome to EduCare</h1>
  <p>Web-based classroom facility complaint and maintenance system.<br>Efficiently register, track, and resolve issues regarding classroom facilities.</p>
  <button onclick="showPage('submitComplaint')">Register a Complaint</button>
</div>

<!-- Complaint Submission -->
<div id="submitComplaint" class="container">
  <h2>Submit a Complaint</h2>
  <form onsubmit="handleComplaintSubmit(event)">
    <label>Facility Type:</label>
    <select id="facilityType" required>
      <option value="">Select</option>
      <option>Fan</option>
      <option>Light</option>
      <option>Bench</option>
      <option>Projector</option>
      <option>Board</option>
      <option>Wi-Fi</option>
    </select>
    <label>Room/Classroom Number:</label>
    <input type="text" id="roomNo" maxlength="10" required>
    <label>Description of Issue:</label>
    <textarea id="issueDescription" rows="4" required></textarea>
    <label>Attach Image (optional):</label>
    <input type="file" id="imageUpload" accept="image/*" onchange="previewImage(event)">
    <div id="imagePreview"></div>
    <button type="submit">Submit</button>
  </form>
</div>

<!-- Track Complaints -->
<div id="trackStatus" class="container">
  <h2>Track Your Complaints</h2>
  <table id="complaintTable">
    <tr><th>ID</th><th>Facility</th><th>Status</th><th>Assigned To</th><th>Date</th><th>Comments</th></tr>
  </table>
</div>

<!-- Staff/Admin Dashboard -->
<div id="staffDashboard" class="container">
  <h2>Staff/Admin Dashboard</h2>
  <button onclick="generateReport()">Generate Report</button>
  <div id="reportArea"></div>
  <div id="staffTableWrap"></div>
</div>

<!-- About -->
<div id="about" class="container">
  <h2>About EduCare</h2>
  <div class="card">
    <p>
      EduCare is a web-based classroom facility complaint and maintenance system designed to streamline the reporting and resolution of facility-related issues. Students and staff can register complaints, track status, and admins/staff can assign and resolve them efficiently.
    </p>
  </div>
</div>

<script>
let complaintId=1000;

// Users
function getUsers(){ return JSON.parse(localStorage.getItem('users')||"[]"); }
function saveUsers(users){ localStorage.setItem('users',JSON.stringify(users)); }

function userSignup(e){
  e.preventDefault();
  const user=document.getElementById('signupUser').value.trim();
  const pass=document.getElementById('signupPass').value;
  let users=getUsers();
  if(users.find(u=>u.username===user)){ alert('Username exists'); return; }
  users.push({username:user,password:pass});
  saveUsers(users);
  localStorage.setItem('ec_loggedin', user);
  alert('Signup successful!');
  renderNavbar(); showPage('home');
}

function userLogin(e){
  e.preventDefault();
  const user=document.getElementById('loginUser').value.trim();
  const pass=document.getElementById('loginPass').value;
  let users=getUsers();

  if(user==='admin' && pass==='admin123'){ localStorage.setItem('ec_loggedin','admin'); alert('Admin login successful!'); renderNavbar(); showPage('home'); return; }
  if(user==='staff' && pass==='staff123'){ localStorage.setItem('ec_loggedin','staff'); alert('Staff login successful!'); renderNavbar(); showPage('staffDashboard'); return; }
  if(users.find(u=>u.username===user && u.password===pass)){ localStorage.setItem('ec_loggedin',user); alert('Login successful!'); renderNavbar(); showPage('home'); return; }

  alert('Invalid credentials!');
}

function logoutUser(){ localStorage.removeItem('ec_loggedin'); showLoginOrSignup('login'); }
function isLoggedIn(){ return !!localStorage.getItem('ec_loggedin'); }

function showLoginOrSignup(page){
  document.querySelectorAll('.container').forEach(el=>el.classList.remove('active'));
  document.getElementById(page).classList.add('active');
  document.getElementById('topnav').classList.remove('active');
}

function showPage(page){
  if(!isLoggedIn()){ showLoginOrSignup('login'); return; }
  document.querySelectorAll('.container').forEach(el=>el.classList.remove('active'));
  let username=localStorage.getItem('ec_loggedin');
  if(username==='staff'){ if(page!=='staffDashboard' && page!=='about') page='staffDashboard'; }
  else if(username==='admin'){ /* admin can access all */ }
  else { if(page==='staffDashboard') page='home'; }
  document.getElementById(page).classList.add('active');
  document.getElementById('topnav').classList.add('active');
  renderNavbar();
  if(page==='trackStatus') populateStatusTable();
  if(page==='staffDashboard') populateStaffTable();
}

function renderNavbar(){
  let username=localStorage.getItem('ec_loggedin');
  let mainLinks=[];
  if(username==='admin'){
    mainLinks=[{name:'Home',page:'home'},{name:'Submit Complaint',page:'submitComplaint'},{name:'Track Status',page:'trackStatus'},{name:'Staff Dashboard',page:'staffDashboard'},{name:'About',page:'about'}];
  } else if(username==='staff'){
    mainLinks=[{name:'Staff Dashboard',page:'staffDashboard'},{name:'About',page:'about'}];
  } else {
    mainLinks=[{name:'Home',page:'home'},{name:'Submit Complaint',page:'submitComplaint'},{name:'Track Status',page:'trackStatus'},{name:'About',page:'about'}];
  }
  let html='';
  mainLinks.forEach(item=>html+=`<a onclick="showPage('${item.page}')">${item.name}</a>`);
  html+=`<span class="logout-link" onclick="logoutUser()">Logout</span>`;
  document.getElementById('mainNavLinks').innerHTML=html;
}

// Complaints
function getComplaintList(){ return JSON.parse(localStorage.getItem('complaints')||"[]"); }
function saveComplaintList(list){ localStorage.setItem('complaints',JSON.stringify(list)); }

function handleComplaintSubmit(e){
  e.preventDefault();
  const facility=document.getElementById('facilityType').value;
  const room=document.getElementById('roomNo').value.trim();
  const desc=document.getElementById('issueDescription').value.trim();
  const date=new Date().toLocaleDateString();
  const fileInput=document.getElementById('imageUpload');
  const imgData=fileInput.files[0]?URL.createObjectURL(fileInput.files[0]):null;
  complaintId++;
  let list=getComplaintList();
  list.push({id:complaintId,facility,room,desc,status:'Submitted',assignedTo:'',date,comments:'-',image:imgData});
  saveComplaintList(list);
  alert('Complaint submitted successfully!');
  document.querySelector('#submitComplaint form').reset();
  document.getElementById('imagePreview').innerHTML='';
}

function populateStatusTable(){
  const list=getComplaintList();
  let body='';
  list.forEach(c=>{
    body+=`<tr><td>${c.id}</td><td>${c.facility}</td><td>${c.status}</td><td>${c.assignedTo||'-'}</td><td>${c.date}</td><td>${c.comments}</td></tr>`;
  });
  document.getElementById('complaintTable').innerHTML=`<tr><th>ID</th><th>Facility</th><th>Status</th><th>Assigned To</th><th>Date</th><th>Comments</th></tr>${body}`;
}

// Modal
function showModal(idx){
  const list=getComplaintList(); const c=list[idx];
  let modalDesc=`<b>ID:</b>${c.id}<br><b>Facility:</b>${c.facility}<br><b>Room:</b>${c.room}<br><b>Date:</b>${c.date}<br><b>Status:</b>${c.status}<br><b>Description:</b><div style="white-space:pre-line;padding:12px 0 6px 0;">${c.desc}</div>`;
  if(c.image) modalDesc+=`<img src="${c.image}" alt="Complaint Image">`;
  document.getElementById('modalDesc').innerHTML=modalDesc;
  document.getElementById('staffModal').classList.add('active');
}
function closeModal(){ document.getElementById('staffModal').classList.remove('active'); }

function populateStaffTable(){
  const username=localStorage.getItem('ec_loggedin');
  const list=getComplaintList();
  if(list.length===0){ document.getElementById('staffTableWrap').innerHTML="<p>No complaints submitted yet.</p>"; return; }
  let t=`<table><tr><th>ID</th><th>Facility</th><th>Room</th><th>Status</th>`;
  if(username==='admin') t+=`<th>Assign To</th>`;
  t+=`<th>Action</th></tr>`;
  list.forEach((c,idx)=>{
    t+=`<tr style="cursor:pointer" title="Click for description" onclick="showModal(${idx})">`;
    t+=`<td>${c.id}</td><td>${c.facility}</td><td>${c.room}</td><td>${c.status}</td>`;
    if(username==='admin'){
      t+=`<td><select onchange="assignToStaff(${idx},this.value)">
            <option value="">Unassigned</option>
            <option value="staff">Staff</option>
          </select></td>`;
    }
    t+=`<td><button onclick="event.stopPropagation();updateStatus(${idx});">Resolve</button></td>`;
    t+=`</tr>`;
  });
  t+='</table>';
  document.getElementById('staffTableWrap').innerHTML=t;
}

function updateStatus(idx){
  let list=getComplaintList();
  const username=localStorage.getItem('ec_loggedin');
  if(username==='staff'||username==='admin'){
    list[idx].status='Resolved';
    list[idx].comments='Fixed by Staff/Admin';
    saveComplaintList(list);
    populateStaffTable();
    alert('Complaint marked as resolved.');
  }
}

function assignToStaff(idx,staff){
  let list=getComplaintList();
  list[idx].assignedTo=staff;
  list[idx].status=staff?'Assigned':'Submitted';
  saveComplaintList(list);
  populateStaffTable();
}

function generateReport(){
  const list=getComplaintList();
  const total=list.length;
  const resolved=list.filter(c=>c.status==='Resolved').length;
  const pending=list.filter(c=>c.status!=='Resolved').length;
  const perFacility={};
  list.forEach(c=>{ perFacility[c.facility]=(perFacility[c.facility]||0)+1; });
  let reportHTML=`<h3>Complaint Report</h3>
    <p>Total Complaints: ${total}</p>
    <p>Resolved: ${resolved}</p>
    <p>Pending: ${pending}</p>
    <h4>Complaints per Facility:</h4><ul>`;
  for(let f in perFacility) reportHTML+=`<li>${f}: ${perFacility[f]}</li>`;
  reportHTML+='</ul>';
  document.getElementById('reportArea').innerHTML=reportHTML;
}

// Image preview
function previewImage(event){
  const file=event.target.files[0]; const preview=document.getElementById('imagePreview');
  if(file){
    const reader=new FileReader();
    reader.onload=function(e){ preview.innerHTML=`<img src="${e.target.result}" alt="Image Preview">`; };
    reader.readAsDataURL(file);
  } else preview.innerHTML='';
}

// Startup
function startup(){
  if(!localStorage.getItem('complaints')) saveComplaintList([]);
  if(!localStorage.getItem('users')) saveUsers([]);

  if(isLoggedIn()){
    renderNavbar();
    let username=localStorage.getItem('ec_loggedin');
    if(username==='staff') showPage('staffDashboard');
    else showPage('home');
  } else {
    // Always show login first
    document.querySelectorAll('.container').forEach(el=>el.classList.remove('active'));
    document.getElementById('login').classList.add('active');
    document.getElementById('topnav').classList.remove('active');
  }
}

window.onload=startup;
</script>
</body>
</html>
